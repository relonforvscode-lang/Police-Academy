# ุชูุฑูุฑ ุฅุตูุงุญ Discord Internal Server Error

## ุงููุดุงูู ุงูุชู ุชู ุงูุชุดุงููุง ูุงูุญู

### ๐ด ุงููุดููุฉ ุงูุฃุณุงุณูุฉ
ุนูุฏ ูุญุงููุฉ ุชุณุฌูู ุงูุฏุฎูู ุนุจุฑ Discord ูุงูุชูุซูุ ูุงู ุงูุฎุงุฏู ูุนุทู `Internal Server Error 500`.

### ๐ ุงูุณุจุจ
ูู ุฏุงูุฉ `discord_oauth_callback()` ุจุงูููู `main/views.py`:

1. **ุฎุทุฃ ูู ูุนุงูุฌุฉ ุงูุงุณุชุซูุงุกุงุช ูู `make_request_with_retry`:**
   - ูุงูุช ุชุญุชูู ุนูู ูุฎ ูุฑูุน ุงูุงุณุชุซูุงุก ุงูุนุงู ููุฑุงู ุฏูู ูุญุงููุฉ ุฅุนุงุฏุฉ ุงูุทูุจ
   - ูุฐุง ูุณุจุจ ูุดู ุงูุชุทุจูู ุนูู ุงูููุฑ

2. **ุงููุชุบูุฑ `response` ูุฏ ูููู ุบูุฑ ูุนุฑู:**
   - ูู ุจุนุถ ุงูุญุงูุงุชุ ูุฏ ูุง ูุชู ุชุนููู ุงููุชุบูุฑ ูู ุฌููุน ูุณุงุฑุงุช ุงูููุฏ

## โ ุงูุญููู ุงููุทุจูุฉ

### 1๏ธโฃ ุชุญุณูู ูุนุงูุฌุฉ ุงูุงุณุชุซูุงุกุงุช
```python
# ูุจู (ุฎุงุทุฆ):
except Exception as e:
    last_exception = e
    raise  # โ ูุฑูุน ุงูุงุณุชุซูุงุก ููุฑุงู!

# ุจุนุฏ (ุตุญูุญ):
except (requests.exceptions.Timeout, requests.exceptions.ConnectionError) as e:
    # ูุญุงููุฉ ุฌุฏูุฏุฉ ูุน ุงูุชุธุงุฑ
    if attempt < max_retries - 1:
        time.sleep(wait_time)
    else:
        raise

except requests.exceptions.RequestException as e:
    # ุงุณุชุซูุงุก ููู ูุฌุจ ุฑูุนู
    logging.error(f"Request exception: {type(e).__name__}")
    raise
```

### 2๏ธโฃ ุชููุฆุฉ ุงููุชุบูุฑุงุช ุจุดูู ุตุญูุญ
```python
response = None
last_exception = None

for attempt in range(max_retries):
    # ูุนุงูุฌุฉ ุงูุทูุจ...
```

### 3๏ธโฃ ุฅุฒุงูุฉ `.session.modified`
- ูุฐุง ุงูุณุทุฑ ููุณ ุถุฑูุฑู ูู Django (ูุชุชุจุน ุงูุชุบููุฑุงุช ุชููุงุฆูุงู)
- ูุงู ูุณุจุจ ุชุญุฐูุฑุงุช ูู ุงูุงุฎุชุจุงุฑุงุช

## ๐งช ุงูุงุฎุชุจุงุฑุงุช ุงููููุฐุฉ

ุชู ุฅูุดุงุก `test_discord_oauth.py` ูุฎุชุจุฑ ุฌููุน ุงูุญุงูุงุช:

โ **ุงุฎุชุจุงุฑุงุช ูุฌุญุช:**
1. โ ุนุฏู ูุฌูุฏ authorization code
2. โ ุฑูุถ Discord ููุทูุจ (access_denied)
3. โ ุจูุงูุงุช ุงุนุชูุงุฏ ููููุฏุฉ (OAuth not configured)
4. โ ูุณุฎุฉ ุบูุฑ ุตุงูุญุฉ ูู access token
5. โ 401 Unauthorized (invalid credentials)
6. **โ ูุนุงูุฌุฉ rate limit ูุน retry** โญ (ุงูุฃูู!)
7. โ ูุฌุงุญ ุงูุชูุซู

## ๐ ููุฎุต ุงูุชุบููุฑุงุช

| ุงูููู | ุงูุชุบููุฑ | ุงูุญุงูุฉ |
|------|---------|--------|
| `main/views.py` | ุฅุถุงูุฉ import `time` | โ ุชู |
| `main/views.py` | ุชุญุณูู `make_request_with_retry` | โ ุชู |
| `main/views.py` | ุฅุฒุงูุฉ `.session.modified` | โ ุชู |
| `test_discord_oauth.py` | ุฅูุดุงุก ููู ุงูุงุฎุชุจุงุฑ ุงูุดุงูู | โ ุชู |

## ๐ ุงูุฎุทูุงุช ุงูุชู ุชู ุงุชุฎุงุฐูุง

### 1. ุชุญุฏูุซ ุงูููุฏ
```bash
โ ุชุญุฏูุซ main/views.py ูุน ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก
โ ุฅุถุงูุฉ retry logic ูุน exponential backoff
โ ุชุญุณูู ุฑุณุงุฆู ุงูุฎุทุฃ
```

### 2. ุงูุงุฎุชุจุงุฑ ุงูุดุงูู
```bash
โ ุชุดุบูู ALL 7 test cases
โ ุงุฎุชุจุงุฑ ุฌููุน ูุณุงุฑุงุช ุงูุฎุทุฃ
โ ุงุฎุชุจุงุฑ retry mechanism
โ ุงุฎุชุจุงุฑ rate limiting
```

### 3. ุงูุชุญูู ุงูููุงุฆู
```bash
โ ุชุดุบูู Django server ุจุฏูู ุฃุฎุทุงุก
โ ูุง ุชูุฌุฏ ุงุณุชุซูุงุกุงุช ุบูุฑ ูุนุงูุฌุฉ
โ ุงูุณุฌูุงุช ุชูุถุญ ุงูุนูููุงุช ุจุดูู ุตุญูุญ
```

## ๐ง ููููุฉ ุงูุงุฎุชุจุงุฑ ุงูุขู

### ุงูุงุฎุชุจุงุฑ ุงููุฏูู:
1. ุงูุชุญ `http://localhost:8000/api/apply/`
2. ุงุถุบุท ุฒุฑ "ุชุณุฌูู ุงูุฏุฎูู ุนุจุฑ Discord"
3. ูุงูู ุนูู ุงูุฃุฐููุงุช
4. ูุฌุจ ุฃู ุชูุนุงุฏ ุชูุฌููู ุฅูู ุตูุญุฉ ุงูุชูุฏูู ุจูุฌุงุญ

### ุงูุงุฎุชุจุงุฑ ุงูุขูู (ุฅุฐุง ุญุฏุซุช ูุดููุฉ):
```bash
python test_discord_oauth.py
```

## โ๏ธ ูุชุทูุจุงุช ุงูุฅูุชุงุฌ

ุชุฃูุฏ ูู ุฃู ูุฏูู ูู ููู `.env`:
```env
DISCORD_CLIENT_ID=your_actual_id
DISCORD_CLIENT_SECRET=your_actual_secret
```

ูุงููุชุบูุฑุงุช ููุฌูุฏุฉ ูู Discord Developer Console:
- Redirect URL: `https://yourapp.com/apply/discord-callback/`

## ๐ ููุงุญุธุงุช ุฅุถุงููุฉ

- **retry logic** ูุญุงูู 3 ูุฑุงุช ูุจู ุงูุงุณุชุณูุงู
- **exponential backoff** ููุชุธุฑ 1ุ 2ุ 4 ุซูุงู ุจูู ุงููุญุงููุงุช
- **rate limiting** ูู Discord ูุชู ุงูุชุนุงูู ูุนู ุชููุงุฆูุงู
- ุฌููุน ุงูุฃุฎุทุงุก **ูุณุฌูุฉ ุจุดูู ููุตู** ูู ุณุฌูุงุช Django

## โจ ุงููุชูุฌุฉ

โ **ุงููุดููุฉ ูุญูููุฉ ุจูุฌุงุญ!** 

- ูุง ูุฒูุฏ ูู `Internal Server Error`
- ูุนุงูุฌุฉ ุฃูุถู ูู rate limiting
- ุงุณุชุซูุงุกุงุช ูุนุงูุฌุฉ ุจุดูู ุตุญูุญ
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ูููุณุชุฎุฏู
