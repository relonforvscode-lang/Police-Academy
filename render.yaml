services:
  - type: web
    name: police-academy
    env: python
    region: oregon
    plan: free
    
    # Build configuration
    buildCommand: bash build/build.sh
    startCommand: gunicorn myproject.wsgi --log-file -
    
    # Auto-deploy on git push
    autoRedeploy: true
    
    # Environment variables
    envVars:
      - key: DJANGO_SECRET_KEY
        scope: run
        value: ${DJANGO_SECRET_KEY}
      
      - key: DEBUG
        value: "False"
      
      - key: ALLOWED_HOSTS
        value: ${RENDER_EXTERNAL_HOSTNAME}

      - key: CSRF_TRUSTED_ORIGINS
        scope: run
        value: https://${RENDER_EXTERNAL_HOSTNAME}
      
      - key: DATABASE_URL
        scope: run
        value: ${DATABASE_URL}
      
      - key: SECURE_SSL_REDIRECT
        value: "True"
  
  # PostgreSQL Database
  - type: pgsql
    name: police-academy-db
    region: oregon
    plan: free
    ipAllowList: []
    
    # Auto-backup
    postgreSQLVersion: "15"

# Health check configuration
healthCheckPath: /admin/

# Docs reference
# https://render.com/docs/infrastructure-as-code
